"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getRouteInfo = getRouteInfo;
exports.prefetchData = prefetchData;
exports.prefetchTemplate = prefetchTemplate;
exports.prefetch = prefetch;
exports.isPrefetchableRoute = isPrefetchableRoute;
exports.plugins = exports.onReloadClientData = exports.registerTemplateForPath = exports.registerTemplates = exports.onReloadTemplates = exports.templateErrorByPath = exports.templatesByPath = exports.templates = exports.registerPlugins = exports.pluginHooks = exports.addPrefetchExcludes = exports.sharedDataByHash = exports.routeErrorByPath = exports.routeInfoByPath = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _typeof2 = _interopRequireDefault(require("@babel/runtime/helpers/typeof"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _axios = _interopRequireDefault(require("axios"));

var _utils = require("./utils");

var _Visibility = _interopRequireDefault(require("./utils/Visibility"));

//
// RouteInfo / RouteData
var routeInfoByPath = {};
exports.routeInfoByPath = routeInfoByPath;
var routeErrorByPath = {};
exports.routeErrorByPath = routeErrorByPath;
var sharedDataByHash = {};
exports.sharedDataByHash = sharedDataByHash;
var inflightRouteInfo = {};
var inflightPropHashes = {};
var prefetchExcludes = [];

var addPrefetchExcludes = function addPrefetchExcludes(excludes) {
  if (!Array.isArray(excludes)) {
    throw new Error('Excludes must be an array of strings/regex!');
  }

  prefetchExcludes = [].concat((0, _toConsumableArray2["default"])(prefetchExcludes), (0, _toConsumableArray2["default"])(excludes));
};

exports.addPrefetchExcludes = addPrefetchExcludes;
var requestPool = (0, _utils.createPool)({
  concurrency: Number(process.env.REACT_STATIC_PREFETCH_RATE)
}); // Plugins

var pluginHooks = [];
exports.pluginHooks = pluginHooks;

var registerPlugins = function registerPlugins(newPlugins) {
  pluginHooks.splice.apply(pluginHooks, [0, Infinity].concat((0, _toConsumableArray2["default"])(newPlugins)));
}; // Templates


exports.registerPlugins = registerPlugins;
var templates = {};
exports.templates = templates;
var templatesByPath = {};
exports.templatesByPath = templatesByPath;
var templateErrorByPath = {};
exports.templateErrorByPath = templateErrorByPath;

var onReloadTemplates = function onReloadTemplates(fn) {
  onReloadTemplates.listeners.push(fn);
  return function () {
    onReloadTemplates.listeners = onReloadTemplates.listeners.filter(function (d) {
      return d !== fn;
    });
  };
};

exports.onReloadTemplates = onReloadTemplates;
onReloadTemplates.listeners = [];

var registerTemplates = /*#__PURE__*/function () {
  var _ref = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee(tmps, notFoundKey) {
    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            Object.keys(templatesByPath).forEach(function (key) {
              delete templatesByPath[key];
            });
            Object.keys(templateErrorByPath).forEach(function (key) {
              delete templateErrorByPath[key];
            });
            Object.keys(templates).forEach(function (key) {
              delete templates[key];
            });
            Object.keys(tmps).forEach(function (key) {
              templates[key] = tmps[key];
            });
            templatesByPath[_utils.PATH_404] = templates[notFoundKey];

            if (!(process.env.NODE_ENV === 'development' && typeof document !== 'undefined')) {
              _context.next = 8;
              break;
            }

            _context.next = 8;
            return prefetch(window.location.pathname);

          case 8:
            onReloadTemplates.listeners.forEach(function (fn) {
              return fn();
            });

            if (typeof document !== 'undefined' && process.env.REACT_STATIC_SILENT !== 'true') {
              console.log('React Static: Templates Reloaded');
            }

          case 10:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  }));

  return function registerTemplates(_x, _x2) {
    return _ref.apply(this, arguments);
  };
}();

exports.registerTemplates = registerTemplates;

var registerTemplateForPath = function registerTemplateForPath(path, template) {
  path = (0, _utils.getRoutePath)(path);
  templatesByPath[path] = templates[template];
};

exports.registerTemplateForPath = registerTemplateForPath;

var onReloadClientData = function onReloadClientData(fn) {
  Object.keys(routeErrorByPath).forEach(function (key) {
    delete routeErrorByPath[key];
  });
  onReloadClientData.listeners.push(fn);
  return function () {
    onReloadClientData.listeners = onReloadClientData.listeners.filter(function (d) {
      return d !== fn;
    });
  };
};

exports.onReloadClientData = onReloadClientData;
onReloadClientData.listeners = [];

if (typeof document !== 'undefined') {
  init();
} // When in development, init a socket to listen for data changes
// When the data changes, we invalidate and reload all of the route data


function init() {
  // In development, we need to open a socket to listen for changes to data
  if (process.env.REACT_STATIC_ENV === 'development') {
    var io = require('socket.io-client');

    var run = /*#__PURE__*/function () {
      var _ref2 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee2() {
        var socket;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                try {
                  socket = io();
                  socket.on('connect', function () {// Do nothing
                  });
                  socket.on('message', function (_ref3) {
                    var type = _ref3.type;

                    if (type === 'reloadClientData') {
                      reloadClientData();
                    }
                  });
                } catch (err) {
                  console.log('React-Static data hot-loader websocket encountered the following error:');
                  console.error(err);
                }

              case 1:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2);
      }));

      return function run() {
        return _ref2.apply(this, arguments);
      };
    }();

    run();
  }

  if (process.env.REACT_STATIC_DISABLE_PRELOAD === 'false') {
    startPreloader();
  }
}
/**
 * The preloader searches for all anchor elements on the page every poll
 * interval, and, unless specified by data-prefetch, start a visibility observer
 * for that element.
 *
 * The href of the anchor is preloaded when the element becomes visible.
 */


function startPreloader() {
  if (typeof document === 'undefined') {
    return;
  }

  var run = function run() {
    var els = [].slice.call(document.getElementsByTagName('a'));
    els.forEach(function (el) {
      var href = el.getAttribute('href');
      var prefetchOption = el.getAttribute('data-prefetch');
      var shouldPrefetch = !prefetchOption || prefetchOption === 'true' || prefetchOption === 'visible';

      if (href && shouldPrefetch) {
        (0, _Visibility["default"])(el, function () {
          return prefetch(href);
        });
      }
    });
  };

  setInterval(run, Number(process.env.REACT_STATIC_PRELOAD_POLL_INTERVAL));
}

function reloadClientData() {
  return _reloadClientData.apply(this, arguments);
}

function _reloadClientData() {
  _reloadClientData = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee3() {
    return _regenerator["default"].wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            console.log('React Static: Reloading Data...') // Delete all cached data
            ;
            [routeInfoByPath, sharedDataByHash, routeErrorByPath, inflightRouteInfo, inflightPropHashes].forEach(function (part) {
              Object.keys(part).forEach(function (key) {
                delete part[key];
              });
            }); // Prefetch the current route's data before you reload routes

            _context3.next = 4;
            return prefetch(window.location.pathname);

          case 4:
            onReloadClientData.listeners.forEach(function (fn) {
              return fn();
            });

          case 5:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3);
  }));
  return _reloadClientData.apply(this, arguments);
}

function getRouteInfo(_x3) {
  return _getRouteInfo.apply(this, arguments);
}

function _getRouteInfo() {
  _getRouteInfo = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee4(path) {
    var _ref4,
        priority,
        routeInfo,
        _yield$inflightRouteI,
        data,
        routeInfoRoot,
        getPath,
        _yield$axios$get,
        _data,
        _yield$inflightRouteI2,
        _data2,
        _args4 = arguments;

    return _regenerator["default"].wrap(function _callee4$(_context4) {
      while (1) {
        switch (_context4.prev = _context4.next) {
          case 0:
            _ref4 = _args4.length > 1 && _args4[1] !== undefined ? _args4[1] : {}, priority = _ref4.priority;
            path = (0, _utils.getRoutePath)(path); // Check if we should fetch RouteData for this url et all.

            if (isPrefetchableRoute(path)) {
              _context4.next = 4;
              break;
            }

            return _context4.abrupt("return");

          case 4:
            if (!routeInfoByPath[path]) {
              _context4.next = 6;
              break;
            }

            return _context4.abrupt("return", routeInfoByPath[path]);

          case 6:
            if (!routeErrorByPath[path]) {
              _context4.next = 8;
              break;
            }

            return _context4.abrupt("return");

          case 8:
            _context4.prev = 8;

            if (!(process.env.REACT_STATIC_ENV === 'development')) {
              _context4.next = 18;
              break;
            }

            // In dev, request from the webpack dev server
            if (!inflightRouteInfo[path]) {
              inflightRouteInfo[path] = _axios["default"].get("/__react-static__/routeInfo/".concat(path === '/' ? '' : path));
            }

            _context4.next = 13;
            return inflightRouteInfo[path];

          case 13:
            _yield$inflightRouteI = _context4.sent;
            data = _yield$inflightRouteI.data;
            routeInfo = data;
            _context4.next = 34;
            break;

          case 18:
            // In production, fetch the JSON file
            // Find the location of the routeInfo.json file
            routeInfoRoot = (process.env.REACT_STATIC_DISABLE_ROUTE_PREFIXING === 'true' ? process.env.REACT_STATIC_SITE_ROOT : process.env.REACT_STATIC_PUBLIC_PATH) || '/';
            getPath = "".concat(routeInfoRoot).concat((0, _utils.pathJoin)(path, 'routeInfo.json')); // If this is a priority call bypass the queue

            if (!priority) {
              _context4.next = 28;
              break;
            }

            _context4.next = 23;
            return _axios["default"].get(getPath);

          case 23:
            _yield$axios$get = _context4.sent;
            _data = _yield$axios$get.data;
            routeInfo = _data;
            _context4.next = 34;
            break;

          case 28:
            // Otherwise, add it to the queue
            if (!inflightRouteInfo[path]) {
              inflightRouteInfo[path] = requestPool.add(function () {
                return _axios["default"].get(getPath);
              });
            }

            _context4.next = 31;
            return inflightRouteInfo[path];

          case 31:
            _yield$inflightRouteI2 = _context4.sent;
            _data2 = _yield$inflightRouteI2.data;
            routeInfo = _data2;

          case 34:
            _context4.next = 43;
            break;

          case 36:
            _context4.prev = 36;
            _context4.t0 = _context4["catch"](8);
            // If there was an error, mark the path as errored
            routeErrorByPath[path] = true; // Unless we already fetched the 404 page,
            // try to load info for the 404 page

            if (!(!routeInfoByPath[_utils.PATH_404] && !routeErrorByPath[_utils.PATH_404])) {
              _context4.next = 42;
              break;
            }

            getRouteInfo(_utils.PATH_404, {
              priority: priority
            });
            return _context4.abrupt("return");

          case 42:
            return _context4.abrupt("return");

          case 43:
            if (!priority) {
              delete inflightRouteInfo[path];
            }

            if ((0, _typeof2["default"])(routeInfo) !== 'object' || !routeInfo.path) {
              // routeInfo must have returned 200, but is not actually
              // a routeInfo object. Mark it as an error and move on silently
              routeErrorByPath[path] = true;
            } else {
              routeInfoByPath[path] = routeInfo;
            }

            return _context4.abrupt("return", routeInfoByPath[path]);

          case 46:
          case "end":
            return _context4.stop();
        }
      }
    }, _callee4, null, [[8, 36]]);
  }));
  return _getRouteInfo.apply(this, arguments);
}

function prefetchData(_x4) {
  return _prefetchData.apply(this, arguments);
}

function _prefetchData() {
  _prefetchData = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee6(path) {
    var _ref5,
        priority,
        routeInfo,
        _args6 = arguments;

    return _regenerator["default"].wrap(function _callee6$(_context6) {
      while (1) {
        switch (_context6.prev = _context6.next) {
          case 0:
            _ref5 = _args6.length > 1 && _args6[1] !== undefined ? _args6[1] : {}, priority = _ref5.priority;
            _context6.next = 3;
            return getRouteInfo(path, {
              priority: priority
            });

          case 3:
            routeInfo = _context6.sent;

            if (routeInfo) {
              _context6.next = 6;
              break;
            }

            return _context6.abrupt("return");

          case 6:
            if (!routeInfo.sharedData) {
              _context6.next = 8;
              break;
            }

            return _context6.abrupt("return", (0, _utils.getFullRouteData)(routeInfo));

          case 8:
            // Request and build the props one by one
            routeInfo.sharedData = {}; // Request the template and loop over the routeInfo.sharedHashesByProp, requesting each prop

            _context6.next = 11;
            return Promise.all(Object.keys(routeInfo.sharedHashesByProp).map( /*#__PURE__*/function () {
              var _ref7 = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee5(key) {
                var hash, staticDataPath, absoluteStaticDataPath, _yield$axios$get2, prop, _yield$inflightPropHa, _prop;

                return _regenerator["default"].wrap(function _callee5$(_context5) {
                  while (1) {
                    switch (_context5.prev = _context5.next) {
                      case 0:
                        hash = routeInfo.sharedHashesByProp[key]; // Check the sharedDataByHash first

                        if (sharedDataByHash[hash]) {
                          _context5.next = 26;
                          break;
                        }

                        _context5.prev = 2;
                        staticDataPath = (0, _utils.pathJoin)(process.env.REACT_STATIC_ASSETS_PATH, "staticData/".concat(hash, ".json"));
                        absoluteStaticDataPath = (0, _utils.makePathAbsolute)(staticDataPath); // If priority, get it immediately

                        if (!priority) {
                          _context5.next = 13;
                          break;
                        }

                        _context5.next = 8;
                        return _axios["default"].get(absoluteStaticDataPath);

                      case 8:
                        _yield$axios$get2 = _context5.sent;
                        prop = _yield$axios$get2.data;
                        sharedDataByHash[hash] = prop;
                        _context5.next = 19;
                        break;

                      case 13:
                        // Non priority, share inflight requests and use pool
                        if (!inflightPropHashes[hash]) {
                          inflightPropHashes[hash] = requestPool.add(function () {
                            return _axios["default"].get(absoluteStaticDataPath);
                          });
                        }

                        _context5.next = 16;
                        return inflightPropHashes[hash];

                      case 16:
                        _yield$inflightPropHa = _context5.sent;
                        _prop = _yield$inflightPropHa.data;
                        // Place it in the cache
                        sharedDataByHash[hash] = _prop;

                      case 19:
                        _context5.next = 25;
                        break;

                      case 21:
                        _context5.prev = 21;
                        _context5.t0 = _context5["catch"](2);
                        console.log('Error: There was an error retrieving a prop for this route! hashID:', hash);
                        console.error(_context5.t0);

                      case 25:
                        if (!priority) {
                          delete inflightPropHashes[hash];
                        }

                      case 26:
                        // Otherwise, just set it as the key
                        routeInfo.sharedData[key] = sharedDataByHash[hash];

                      case 27:
                      case "end":
                        return _context5.stop();
                    }
                  }
                }, _callee5, null, [[2, 21]]);
              }));

              return function (_x7) {
                return _ref7.apply(this, arguments);
              };
            }()));

          case 11:
            return _context6.abrupt("return", (0, _utils.getFullRouteData)(routeInfo));

          case 12:
          case "end":
            return _context6.stop();
        }
      }
    }, _callee6);
  }));
  return _prefetchData.apply(this, arguments);
}

function prefetchTemplate(_x5) {
  return _prefetchTemplate.apply(this, arguments);
}

function _prefetchTemplate() {
  _prefetchTemplate = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee7(path) {
    var _ref6,
        priority,
        routeInfo,
        Template,
        _args7 = arguments;

    return _regenerator["default"].wrap(function _callee7$(_context7) {
      while (1) {
        switch (_context7.prev = _context7.next) {
          case 0:
            _ref6 = _args7.length > 1 && _args7[1] !== undefined ? _args7[1] : {}, priority = _ref6.priority;
            // Clean the path
            path = (0, _utils.getRoutePath)(path); // Get route info so we can check if path has any data

            _context7.next = 4;
            return getRouteInfo(path, {
              priority: priority
            });

          case 4:
            routeInfo = _context7.sent;

            if (routeInfo) {
              // Make sure to use the path as defined in the routeInfo object here.
              // This will make sure 404 route info returned from getRouteInfo is handled correctly.
              registerTemplateForPath(routeInfo.path, routeInfo.template);
            } // Preload the template if available


            Template = templatesByPath[path];

            if (Template) {
              _context7.next = 10;
              break;
            }

            // If no template was found, mark it with an error
            templateErrorByPath[path] = true;
            return _context7.abrupt("return");

          case 10:
            if (routeInfo) {
              _context7.next = 12;
              break;
            }

            return _context7.abrupt("return", Template);

          case 12:
            if (!(!routeInfo.templateLoaded && Template.preload)) {
              _context7.next = 21;
              break;
            }

            if (!priority) {
              _context7.next = 18;
              break;
            }

            _context7.next = 16;
            return Template.preload();

          case 16:
            _context7.next = 20;
            break;

          case 18:
            _context7.next = 20;
            return requestPool.add(function () {
              return Template.preload();
            });

          case 20:
            routeInfo.templateLoaded = true;

          case 21:
            return _context7.abrupt("return", Template);

          case 22:
          case "end":
            return _context7.stop();
        }
      }
    }, _callee7);
  }));
  return _prefetchTemplate.apply(this, arguments);
}

function prefetch(_x6) {
  return _prefetch.apply(this, arguments);
}

function _prefetch() {
  _prefetch = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee8(path) {
    var options,
        type,
        data,
        _yield$Promise$all,
        _yield$Promise$all2,
        _args8 = arguments;

    return _regenerator["default"].wrap(function _callee8$(_context8) {
      while (1) {
        switch (_context8.prev = _context8.next) {
          case 0:
            options = _args8.length > 1 && _args8[1] !== undefined ? _args8[1] : {};
            // Clean the path
            path = (0, _utils.getRoutePath)(path);
            type = options.type; // If it's priority, we stop the queue temporarily

            if (options.priority) {
              requestPool.stop();
            }

            if (!(type === 'data')) {
              _context8.next = 10;
              break;
            }

            _context8.next = 7;
            return prefetchData(path, options);

          case 7:
            data = _context8.sent;
            _context8.next = 21;
            break;

          case 10:
            if (!(type === 'template')) {
              _context8.next = 15;
              break;
            }

            _context8.next = 13;
            return prefetchTemplate(path, options);

          case 13:
            _context8.next = 21;
            break;

          case 15:
            ;
            _context8.next = 18;
            return Promise.all([prefetchData(path, options), prefetchTemplate(path, options)]);

          case 18:
            _yield$Promise$all = _context8.sent;
            _yield$Promise$all2 = (0, _slicedToArray2["default"])(_yield$Promise$all, 1);
            data = _yield$Promise$all2[0];

          case 21:
            // If it was priority, start the queue again
            if (options.priority) {
              requestPool.start();
            }

            return _context8.abrupt("return", data);

          case 23:
          case "end":
            return _context8.stop();
        }
      }
    }, _callee8);
  }));
  return _prefetch.apply(this, arguments);
}

function isPrefetchableRoute(path) {
  // when rendering static pages we dont need this at all
  if (typeof document === 'undefined') {
    return false;
  }

  if (prefetchExcludes.some(function (exclude) {
    if (typeof exclude === 'string' && path.startsWith(exclude)) {
      return true;
    }

    if ((0, _typeof2["default"])(exclude) === 'object' && exclude.test(path)) {
      return true;
    }

    return false;
  })) {
    return false;
  }

  var _document = document,
      location = _document.location;
  var link;

  try {
    link = new URL(path, location.href);
  } catch (e) {
    if (typeof URL !== 'function') {
      console.error('URL polyfill is required for this browser. https://github.com/react-static/react-static/blob/master/docs/concepts.md#browser-support');
    } // Return false on invalid URLs


    return false;
  } // if the hostname/port/protocol doesn't match its not a route link


  if (location.host !== link.host || location.protocol !== link.protocol) {
    return false;
  } // deny all files with extension other than .html
  // Reverting this change because of issue #1354
  // if (link.pathname.includes('.') && !link.pathname.includes('.html')) {
  //   return false
  // }


  return true;
}

var plugins = {
  Root: function Root(Comp) {
    var hooks = (0, _utils.getHooks)(pluginHooks, 'Root');
    return (0, _utils.reduceHooks)(hooks, {
      sync: true
    })(Comp);
  },
  Routes: function Routes(Comp) {
    var hooks = (0, _utils.getHooks)(pluginHooks, 'Routes');
    return (0, _utils.reduceHooks)(hooks, {
      sync: true
    })(Comp);
  }
};
exports.plugins = plugins;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9icm93c2VyL2luZGV4LmpzIl0sIm5hbWVzIjpbInJvdXRlSW5mb0J5UGF0aCIsInJvdXRlRXJyb3JCeVBhdGgiLCJzaGFyZWREYXRhQnlIYXNoIiwiaW5mbGlnaHRSb3V0ZUluZm8iLCJpbmZsaWdodFByb3BIYXNoZXMiLCJwcmVmZXRjaEV4Y2x1ZGVzIiwiYWRkUHJlZmV0Y2hFeGNsdWRlcyIsImV4Y2x1ZGVzIiwiQXJyYXkiLCJpc0FycmF5IiwiRXJyb3IiLCJyZXF1ZXN0UG9vbCIsImNvbmN1cnJlbmN5IiwiTnVtYmVyIiwicHJvY2VzcyIsImVudiIsIlJFQUNUX1NUQVRJQ19QUkVGRVRDSF9SQVRFIiwicGx1Z2luSG9va3MiLCJyZWdpc3RlclBsdWdpbnMiLCJuZXdQbHVnaW5zIiwic3BsaWNlIiwiSW5maW5pdHkiLCJ0ZW1wbGF0ZXMiLCJ0ZW1wbGF0ZXNCeVBhdGgiLCJ0ZW1wbGF0ZUVycm9yQnlQYXRoIiwib25SZWxvYWRUZW1wbGF0ZXMiLCJmbiIsImxpc3RlbmVycyIsInB1c2giLCJmaWx0ZXIiLCJkIiwicmVnaXN0ZXJUZW1wbGF0ZXMiLCJ0bXBzIiwibm90Rm91bmRLZXkiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsImtleSIsIlBBVEhfNDA0IiwiTk9ERV9FTlYiLCJkb2N1bWVudCIsInByZWZldGNoIiwid2luZG93IiwibG9jYXRpb24iLCJwYXRobmFtZSIsIlJFQUNUX1NUQVRJQ19TSUxFTlQiLCJjb25zb2xlIiwibG9nIiwicmVnaXN0ZXJUZW1wbGF0ZUZvclBhdGgiLCJwYXRoIiwidGVtcGxhdGUiLCJvblJlbG9hZENsaWVudERhdGEiLCJpbml0IiwiUkVBQ1RfU1RBVElDX0VOViIsImlvIiwicmVxdWlyZSIsInJ1biIsInNvY2tldCIsIm9uIiwidHlwZSIsInJlbG9hZENsaWVudERhdGEiLCJlcnIiLCJlcnJvciIsIlJFQUNUX1NUQVRJQ19ESVNBQkxFX1BSRUxPQUQiLCJzdGFydFByZWxvYWRlciIsImVscyIsInNsaWNlIiwiY2FsbCIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZWwiLCJocmVmIiwiZ2V0QXR0cmlidXRlIiwicHJlZmV0Y2hPcHRpb24iLCJzaG91bGRQcmVmZXRjaCIsInNldEludGVydmFsIiwiUkVBQ1RfU1RBVElDX1BSRUxPQURfUE9MTF9JTlRFUlZBTCIsInBhcnQiLCJnZXRSb3V0ZUluZm8iLCJwcmlvcml0eSIsImlzUHJlZmV0Y2hhYmxlUm91dGUiLCJheGlvcyIsImdldCIsImRhdGEiLCJyb3V0ZUluZm8iLCJyb3V0ZUluZm9Sb290IiwiUkVBQ1RfU1RBVElDX0RJU0FCTEVfUk9VVEVfUFJFRklYSU5HIiwiUkVBQ1RfU1RBVElDX1NJVEVfUk9PVCIsIlJFQUNUX1NUQVRJQ19QVUJMSUNfUEFUSCIsImdldFBhdGgiLCJhZGQiLCJwcmVmZXRjaERhdGEiLCJzaGFyZWREYXRhIiwiUHJvbWlzZSIsImFsbCIsInNoYXJlZEhhc2hlc0J5UHJvcCIsIm1hcCIsImhhc2giLCJzdGF0aWNEYXRhUGF0aCIsIlJFQUNUX1NUQVRJQ19BU1NFVFNfUEFUSCIsImFic29sdXRlU3RhdGljRGF0YVBhdGgiLCJwcm9wIiwicHJlZmV0Y2hUZW1wbGF0ZSIsIlRlbXBsYXRlIiwidGVtcGxhdGVMb2FkZWQiLCJwcmVsb2FkIiwib3B0aW9ucyIsInN0b3AiLCJzdGFydCIsInNvbWUiLCJleGNsdWRlIiwic3RhcnRzV2l0aCIsInRlc3QiLCJsaW5rIiwiVVJMIiwiZSIsImhvc3QiLCJwcm90b2NvbCIsInBsdWdpbnMiLCJSb290IiwiQ29tcCIsImhvb2tzIiwic3luYyIsIlJvdXRlcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBRUE7O0FBVUE7O0FBWEE7QUFhQTtBQUNPLElBQU1BLGVBQWUsR0FBRyxFQUF4Qjs7QUFDQSxJQUFNQyxnQkFBZ0IsR0FBRyxFQUF6Qjs7QUFDQSxJQUFNQyxnQkFBZ0IsR0FBRyxFQUF6Qjs7QUFDUCxJQUFNQyxpQkFBaUIsR0FBRyxFQUExQjtB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QUksRUFBRSxjQUFBQyxJQUFJLEVBQUk7QUFDWixRQUFNQyxLQUFLLEdBQUcscUJBQVN2RyxXQUFULEVBQXNCLE1BQXRCLENBQWQ7QUFDQSxXQUFPLHdCQUFZdUcsS0FBWixFQUFtQjtBQUFFQyxNQUFBQSxJQUFJLEVBQUU7QUFBUixLQUFuQixFQUFtQ0YsSUFBbkMsQ0FBUDtBQUNELEdBSm9CO0FBS3JCRyxFQUFBQSxNQUFNLEVBQUUsZ0JBQUFILElBQUksRUFBSTtBQUNkLFFBQU1DLEtBQUssR0FBRyxxQkFBU3ZHLFdBQVQsRUFBc0IsUUFBdEIsQ0FBZDtBQUNBLFdBQU8sd0JBQVl1RyxLQUFaLEVBQW1CO0FBQUVDLE1BQUFBLElBQUksRUFBRTtBQUFSLEtBQW5CLEVBQW1DRixJQUFuQyxDQUFQO0FBQ0Q7QUFSb0IsQ0FBaEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnXG4vL1xuaW1wb3J0IHtcbiAgY3JlYXRlUG9vbCxcbiAgZ2V0Um91dGVQYXRoLFxuICBwYXRoSm9pbixcbiAgZ2V0RnVsbFJvdXRlRGF0YSxcbiAgbWFrZVBhdGhBYnNvbHV0ZSxcbiAgZ2V0SG9va3MsXG4gIHJlZHVjZUhvb2tzLFxuICBQQVRIXzQwNCxcbn0gZnJvbSAnLi91dGlscydcbmltcG9ydCBvblZpc2libGUgZnJvbSAnLi91dGlscy9WaXNpYmlsaXR5J1xuXG4vLyBSb3V0ZUluZm8gLyBSb3V0ZURhdGFcbmV4cG9ydCBjb25zdCByb3V0ZUluZm9CeVBhdGggPSB7fVxuZXhwb3J0IGNvbnN0IHJvdXRlRXJyb3JCeVBhdGggPSB7fVxuZXhwb3J0IGNvbnN0IHNoYXJlZERhdGFCeUhhc2ggPSB7fVxuY29uc3QgaW5mbGlnaHRSb3V0ZUluZm8gPSB7fVxuY29uc3QgaW5mbGlnaHRQcm9wSGFzaGVzID0ge31cbmxldCBwcmVmZXRjaEV4Y2x1ZGVzID0gW11cblxuZXhwb3J0IGNvbnN0IGFkZFByZWZldGNoRXhjbHVkZXMgPSBleGNsdWRlcyA9PiB7XG4gIGlmICghQXJyYXkuaXNBcnJheShleGNsdWRlcykpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4Y2x1ZGVzIG11c3QgYmUgYW4gYXJyYXkgb2Ygc3RyaW5ncy9yZWdleCEnKVxuICB9XG4gIHByZWZldGNoRXhjbHVkZXMgPSBbLi4ucHJlZmV0Y2hFeGNsdWRlcywgLi4uZXhjbHVkZXNdXG59XG5cbmNvbnN0IHJlcXVlc3RQb29sID0gY3JlYXRlUG9vbCh7XG4gIGNvbmN1cnJlbmN5OiBOdW1iZXIocHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX1BSRUZFVENIX1JBVEUpLFxufSlcblxuLy8gUGx1Z2luc1xuZXhwb3J0IGNvbnN0IHBsdWdpbkhvb2tzID0gW11cbmV4cG9ydCBjb25zdCByZWdpc3RlclBsdWdpbnMgPSBuZXdQbHVnaW5zID0+IHtcbiAgcGx1Z2luSG9va3Muc3BsaWNlKDAsIEluZmluaXR5LCAuLi5uZXdQbHVnaW5zKVxufVxuXG4vLyBUZW1wbGF0ZXNcbmV4cG9ydCBjb25zdCB0ZW1wbGF0ZXMgPSB7fVxuZXhwb3J0IGNvbnN0IHRlbXBsYXRlc0J5UGF0aCA9IHt9XG5leHBvcnQgY29uc3QgdGVtcGxhdGVFcnJvckJ5UGF0aCA9IHt9XG5leHBvcnQgY29uc3Qgb25SZWxvYWRUZW1wbGF0ZXMgPSBmbiA9PiB7XG4gIG9uUmVsb2FkVGVtcGxhdGVzLmxpc3RlbmVycy5wdXNoKGZuKVxuICByZXR1cm4gKCkgPT4ge1xuICAgIG9uUmVsb2FkVGVtcGxhdGVzLmxpc3RlbmVycyA9IG9uUmVsb2FkVGVtcGxhdGVzLmxpc3RlbmVycy5maWx0ZXIoXG4gICAgICBkID0+IGQgIT09IGZuXG4gICAgKVxuICB9XG59XG5vblJlbG9hZFRlbXBsYXRlcy5saXN0ZW5lcnMgPSBbXVxuXG5leHBvcnQgY29uc3QgcmVnaXN0ZXJUZW1wbGF0ZXMgPSBhc3luYyAodG1wcywgbm90Rm91bmRLZXkpID0+IHtcbiAgT2JqZWN0LmtleXModGVtcGxhdGVzQnlQYXRoKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgZGVsZXRlIHRlbXBsYXRlc0J5UGF0aFtrZXldXG4gIH0pXG4gIE9iamVjdC5rZXlzKHRlbXBsYXRlRXJyb3JCeVBhdGgpLmZvckVhY2goa2V5ID0+IHtcbiAgICBkZWxldGUgdGVtcGxhdGVFcnJvckJ5UGF0aFtrZXldXG4gIH0pXG4gIE9iamVjdC5rZXlzKHRlbXBsYXRlcykuZm9yRWFjaChrZXkgPT4ge1xuICAgIGRlbGV0ZSB0ZW1wbGF0ZXNba2V5XVxuICB9KVxuICBPYmplY3Qua2V5cyh0bXBzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgdGVtcGxhdGVzW2tleV0gPSB0bXBzW2tleV1cbiAgfSlcbiAgdGVtcGxhdGVzQnlQYXRoW1BBVEhfNDA0XSA9IHRlbXBsYXRlc1tub3RGb3VuZEtleV1cblxuICBpZiAoXG4gICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgJiZcbiAgICB0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnXG4gICkge1xuICAgIGF3YWl0IHByZWZldGNoKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSlcbiAgfVxuXG4gIG9uUmVsb2FkVGVtcGxhdGVzLmxpc3RlbmVycy5mb3JFYWNoKGZuID0+IGZuKCkpXG5cbiAgaWYgKFxuICAgIHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICBwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfU0lMRU5UICE9PSAndHJ1ZSdcbiAgKSB7XG4gICAgY29uc29sZS5sb2coJ1JlYWN0IFN0YXRpYzogVGVtcGxhdGVzIFJlbG9hZGVkJylcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgcmVnaXN0ZXJUZW1wbGF0ZUZvclBhdGggPSAocGF0aCwgdGVtcGxhdGUpID0+IHtcbiAgcGF0aCA9IGdldFJvdXRlUGF0aChwYXRoKVxuICB0ZW1wbGF0ZXNCeVBhdGhbcGF0aF0gPSB0ZW1wbGF0ZXNbdGVtcGxhdGVdXG59XG5cbmV4cG9ydCBjb25zdCBvblJlbG9hZENsaWVudERhdGEgPSBmbiA9PiB7XG4gIE9iamVjdC5rZXlzKHJvdXRlRXJyb3JCeVBhdGgpLmZvckVhY2goa2V5ID0+IHtcbiAgICBkZWxldGUgcm91dGVFcnJvckJ5UGF0aFtrZXldXG4gIH0pXG4gIG9uUmVsb2FkQ2xpZW50RGF0YS5saXN0ZW5lcnMucHVzaChmbilcbiAgcmV0dXJuICgpID0+IHtcbiAgICBvblJlbG9hZENsaWVudERhdGEubGlzdGVuZXJzID0gb25SZWxvYWRDbGllbnREYXRhLmxpc3RlbmVycy5maWx0ZXIoXG4gICAgICBkID0+IGQgIT09IGZuXG4gICAgKVxuICB9XG59XG5vblJlbG9hZENsaWVudERhdGEubGlzdGVuZXJzID0gW11cblxuaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgaW5pdCgpXG59XG5cbi8vIFdoZW4gaW4gZGV2ZWxvcG1lbnQsIGluaXQgYSBzb2NrZXQgdG8gbGlzdGVuIGZvciBkYXRhIGNoYW5nZXNcbi8vIFdoZW4gdGhlIGRhdGEgY2hhbmdlcywgd2UgaW52YWxpZGF0ZSBhbmQgcmVsb2FkIGFsbCBvZiB0aGUgcm91dGUgZGF0YVxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgLy8gSW4gZGV2ZWxvcG1lbnQsIHdlIG5lZWQgdG8gb3BlbiBhIHNvY2tldCB0byBsaXN0ZW4gZm9yIGNoYW5nZXMgdG8gZGF0YVxuICBpZiAocHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAgIGNvbnN0IGlvID0gcmVxdWlyZSgnc29ja2V0LmlvLWNsaWVudCcpXG4gICAgY29uc3QgcnVuID0gYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc29ja2V0ID0gaW8oKVxuICAgICAgICBzb2NrZXQub24oJ2Nvbm5lY3QnLCAoKSA9PiB7XG4gICAgICAgICAgLy8gRG8gbm90aGluZ1xuICAgICAgICB9KVxuICAgICAgICBzb2NrZXQub24oJ21lc3NhZ2UnLCAoeyB0eXBlIH0pID0+IHtcbiAgICAgICAgICBpZiAodHlwZSA9PT0gJ3JlbG9hZENsaWVudERhdGEnKSB7XG4gICAgICAgICAgICByZWxvYWRDbGllbnREYXRhKClcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgJ1JlYWN0LVN0YXRpYyBkYXRhIGhvdC1sb2FkZXIgd2Vic29ja2V0IGVuY291bnRlcmVkIHRoZSBmb2xsb3dpbmcgZXJyb3I6J1xuICAgICAgICApXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKVxuICAgICAgfVxuICAgIH1cbiAgICBydW4oKVxuICB9XG5cbiAgaWYgKHByb2Nlc3MuZW52LlJFQUNUX1NUQVRJQ19ESVNBQkxFX1BSRUxPQUQgPT09ICdmYWxzZScpIHtcbiAgICBzdGFydFByZWxvYWRlcigpXG4gIH1cbn1cblxuLyoqXG4gKiBUaGUgcHJlbG9hZGVyIHNlYXJjaGVzIGZvciBhbGwgYW5jaG9yIGVsZW1lbnRzIG9uIHRoZSBwYWdlIGV2ZXJ5IHBvbGxcbiAqIGludGVydmFsLCBhbmQsIHVubGVzcyBzcGVjaWZpZWQgYnkgZGF0YS1wcmVmZXRjaCwgc3RhcnQgYSB2aXNpYmlsaXR5IG9ic2VydmVyXG4gKiBmb3IgdGhhdCBlbGVtZW50LlxuICpcbiAqIFRoZSBocmVmIG9mIHRoZSBhbmNob3IgaXMgcHJlbG9hZGVkIHdoZW4gdGhlIGVsZW1lbnQgYmVjb21lcyB2aXNpYmxlLlxuICovXG5mdW5jdGlvbiBzdGFydFByZWxvYWRlcigpIHtcbiAgaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICByZXR1cm5cbiAgfVxuICBjb25zdCBydW4gPSAoKSA9PiB7XG4gICAgY29uc3QgZWxzID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYScpKVxuXG4gICAgZWxzLmZvckVhY2goZWwgPT4ge1xuICAgICAgY29uc3QgaHJlZiA9IGVsLmdldEF0dHJpYnV0ZSgnaHJlZicpXG4gICAgICBjb25zdCBwcmVmZXRjaE9wdGlvbiA9IGVsLmdldEF0dHJpYnV0ZSgnZGF0YS1wcmVmZXRjaCcpXG4gICAgICBjb25zdCBzaG91bGRQcmVmZXRjaCA9XG4gICAgICAgICFwcmVmZXRjaE9wdGlvbiB8fFxuICAgICAgICBwcmVmZXRjaE9wdGlvbiA9PT0gJ3RydWUnIHx8XG4gICAgICAgIHByZWZldGNoT3B0aW9uID09PSAndmlzaWJsZSdcblxuICAgICAgaWYgKGhyZWYgJiYgc2hvdWxkUHJlZmV0Y2gpIHtcbiAgICAgICAgb25WaXNpYmxlKGVsLCAoKSA9PiBwcmVmZXRjaChocmVmKSlcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgc2V0SW50ZXJ2YWwocnVuLCBOdW1iZXIocHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX1BSRUxPQURfUE9MTF9JTlRFUlZBTCkpXG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlbG9hZENsaWVudERhdGEoKSB7XG4gIGNvbnNvbGUubG9nKCdSZWFjdCBTdGF0aWM6IFJlbG9hZGluZyBEYXRhLi4uJylcbiAgLy8gRGVsZXRlIGFsbCBjYWNoZWQgZGF0YVxuICA7W1xuICAgIHJvdXRlSW5mb0J5UGF0aCxcbiAgICBzaGFyZWREYXRhQnlIYXNoLFxuICAgIHJvdXRlRXJyb3JCeVBhdGgsXG4gICAgaW5mbGlnaHRSb3V0ZUluZm8sXG4gICAgaW5mbGlnaHRQcm9wSGFzaGVzLFxuICBdLmZvckVhY2gocGFydCA9PiB7XG4gICAgT2JqZWN0LmtleXMocGFydCkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgZGVsZXRlIHBhcnRba2V5XVxuICAgIH0pXG4gIH0pXG5cbiAgLy8gUHJlZmV0Y2ggdGhlIGN1cnJlbnQgcm91dGUncyBkYXRhIGJlZm9yZSB5b3UgcmVsb2FkIHJvdXRlc1xuICBhd2FpdCBwcmVmZXRjaCh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUpXG5cbiAgb25SZWxvYWRDbGllbnREYXRhLmxpc3RlbmVycy5mb3JFYWNoKGZuID0+IGZuKCkpXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRSb3V0ZUluZm8ocGF0aCwgeyBwcmlvcml0eSB9ID0ge30pIHtcbiAgcGF0aCA9IGdldFJvdXRlUGF0aChwYXRoKVxuXG4gIC8vIENoZWNrIGlmIHdlIHNob3VsZCBmZXRjaCBSb3V0ZURhdGEgZm9yIHRoaXMgdXJsIGV0IGFsbC5cbiAgaWYgKCFpc1ByZWZldGNoYWJsZVJvdXRlKHBhdGgpKSB7XG4gICAgcmV0dXJuXG4gIH1cblxuICAvLyBDaGVjayB0aGUgY2FjaGUgZmlyc3RcbiAgaWYgKHJvdXRlSW5mb0J5UGF0aFtwYXRoXSkge1xuICAgIHJldHVybiByb3V0ZUluZm9CeVBhdGhbcGF0aF1cbiAgfVxuXG4gIC8vIENoZWNrIGZvciBhbiBlcnJvciBvciBub24tZXhpc3RlbnQgc3RhdGljIHJvdXRlXG4gIGlmIChyb3V0ZUVycm9yQnlQYXRoW3BhdGhdKSB7XG4gICAgcmV0dXJuXG4gIH1cblxuICBsZXQgcm91dGVJbmZvXG5cbiAgdHJ5IHtcbiAgICBpZiAocHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX0VOViA9PT0gJ2RldmVsb3BtZW50Jykge1xuICAgICAgLy8gSW4gZGV2LCByZXF1ZXN0IGZyb20gdGhlIHdlYnBhY2sgZGV2IHNlcnZlclxuICAgICAgaWYgKCFpbmZsaWdodFJvdXRlSW5mb1twYXRoXSkge1xuICAgICAgICBpbmZsaWdodFJvdXRlSW5mb1twYXRoXSA9IGF4aW9zLmdldChcbiAgICAgICAgICBgL19fcmVhY3Qtc3RhdGljX18vcm91dGVJbmZvLyR7cGF0aCA9PT0gJy8nID8gJycgOiBwYXRofWBcbiAgICAgICAgKVxuICAgICAgfVxuICAgICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBpbmZsaWdodFJvdXRlSW5mb1twYXRoXVxuICAgICAgcm91dGVJbmZvID0gZGF0YVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJbiBwcm9kdWN0aW9uLCBmZXRjaCB0aGUgSlNPTiBmaWxlXG4gICAgICAvLyBGaW5kIHRoZSBsb2NhdGlvbiBvZiB0aGUgcm91dGVJbmZvLmpzb24gZmlsZVxuICAgICAgY29uc3Qgcm91dGVJbmZvUm9vdCA9XG4gICAgICAgIChwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfRElTQUJMRV9ST1VURV9QUkVGSVhJTkcgPT09ICd0cnVlJ1xuICAgICAgICAgID8gcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX1NJVEVfUk9PVFxuICAgICAgICAgIDogcHJvY2Vzcy5lbnYuUkVBQ1RfU1RBVElDX1BVQkxJQ19QQVRIKSB8fCAnLydcblxuICAgICAgY29uc3QgZ2V0UGF0aCA9IGAke3JvdXRlSW5mb1Jvb3R9JHtwYXRoSm9pbihwYXRoLCAncm91dGVJbmZvLmpzb24nKX1gXG5cbiAgICAgIC8vIElmIHRoaXMgaXMgYSBwcmlvcml0eSBjYWxsIGJ5cGFzcyB0aGUgcXVldWVcbiAgICAgIGlmIChwcmlvcml0eSkge1xuICAgICAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGF4aW9zLmdldChnZXRQYXRoKVxuICAgICAgICByb3V0ZUluZm8gPSBkYXRhXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBPdGhlcndpc2UsIGFkZCBpdCB0byB0aGUgcXVldWVcbiAgICAgICAgaWYgKCFpbmZsaWdodFJvdXRlSW5mb1twYXRoXSkge1xuICAgICAgICAgIGluZmxpZ2h0Um91dGVJbmZvW3BhdGhdID0gcmVxdWVzdFBvb2wuYWRkKCgpID0+IGF4aW9zLmdldChnZXRQYXRoKSlcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGluZmxpZ2h0Um91dGVJbmZvW3BhdGhdXG4gICAgICAgIHJvdXRlSW5mbyA9IGRhdGFcbiAgICAgIH1cbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIC8vIElmIHRoZXJlIHdhcyBhbiBlcnJvciwgbWFyayB0aGUgcGF0aCBhcyBlcnJvcmVkXG4gICAgcm91dGVFcnJvckJ5UGF0aFtwYXRoXSA9IHRydWVcbiAgICAvLyBVbmxlc3Mgd2UgYWxyZWFkeSBmZXRjaGVkIHRoZSA0MDQgcGFnZSxcbiAgICAvLyB0cnkgdG8gbG9hZCBpbmZvIGZvciB0aGUgNDA0IHBhZ2VcbiAgICBpZiAoIXJvdXRlSW5mb0J5UGF0aFtQQVRIXzQwNF0gJiYgIXJvdXRlRXJyb3JCeVBhdGhbUEFUSF80MDRdKSB7XG4gICAgICBnZXRSb3V0ZUluZm8oUEFUSF80MDQsIHsgcHJpb3JpdHkgfSlcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHJldHVyblxuICB9XG4gIGlmICghcHJpb3JpdHkpIHtcbiAgICBkZWxldGUgaW5mbGlnaHRSb3V0ZUluZm9bcGF0aF1cbiAgfVxuICBpZiAodHlwZW9mIHJvdXRlSW5mbyAhPT0gJ29iamVjdCcgfHwgIXJvdXRlSW5mby5wYXRoKSB7XG4gICAgLy8gcm91dGVJbmZvIG11c3QgaGF2ZSByZXR1cm5lZCAyMDAsIGJ1dCBpcyBub3QgYWN0dWFsbHlcbiAgICAvLyBhIHJvdXRlSW5mbyBvYmplY3QuIE1hcmsgaXQgYXMgYW4gZXJyb3IgYW5kIG1vdmUgb24gc2lsZW50bHlcbiAgICByb3V0ZUVycm9yQnlQYXRoW3BhdGhdID0gdHJ1ZVxuICB9IGVsc2Uge1xuICAgIHJvdXRlSW5mb0J5UGF0aFtwYXRoXSA9IHJvdXRlSW5mb1xuICB9XG4gIHJldHVybiByb3V0ZUluZm9CeVBhdGhbcGF0aF1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByZWZldGNoRGF0YShwYXRoLCB7IHByaW9yaXR5IH0gPSB7fSkge1xuICAvLyBHZXQgcm91dGUgaW5mbyBzbyB3ZSBjYW4gY2hlY2sgaWYgcGF0aCBoYXMgYW55IGRhdGFcbiAgY29uc3Qgcm91dGVJbmZvID0gYXdhaXQgZ2V0Um91dGVJbmZvKHBhdGgsIHsgcHJpb3JpdHkgfSlcblxuICAvLyBOb3QgYSBzdGF0aWMgcm91dGU/IEJhaWwgb3V0LlxuICBpZiAoIXJvdXRlSW5mbykge1xuICAgIHJldHVyblxuICB9XG5cbiAgLy8gRGVmZXIgdG8gdGhlIGNhY2hlIGZpcnN0LiBJbiBkZXYgbW9kZSwgdGhpcyBzaG91bGQgYWxyZWFkeSBiZSBhdmFpbGFibGUgZnJvbVxuICAvLyB0aGUgY2FsbCB0byBnZXRSb3V0ZUluZm9cbiAgaWYgKHJvdXRlSW5mby5zaGFyZWREYXRhKSB7XG4gICAgcmV0dXJuIGdldEZ1bGxSb3V0ZURhdGEocm91dGVJbmZvKVxuICB9XG5cbiAgLy8gUmVxdWVzdCBhbmQgYnVpbGQgdGhlIHByb3BzIG9uZSBieSBvbmVcbiAgcm91dGVJbmZvLnNoYXJlZERhdGEgPSB7fVxuXG4gIC8vIFJlcXVlc3QgdGhlIHRlbXBsYXRlIGFuZCBsb29wIG92ZXIgdGhlIHJvdXRlSW5mby5zaGFyZWRIYXNoZXNCeVByb3AsIHJlcXVlc3RpbmcgZWFjaCBwcm9wXG4gIGF3YWl0IFByb21pc2UuYWxsKFxuICAgIE9iamVjdC5rZXlzKHJvdXRlSW5mby5zaGFyZWRIYXNoZXNCeVByb3ApLm1hcChhc3luYyBrZXkgPT4ge1xuICAgICAgY29uc3QgaGFzaCA9IHJvdXRlSW5mby5zaGFyZWRIYXNoZXNCeVByb3Bba2V5XVxuXG4gICAgICAvLyBDaGVjayB0aGUgc2hhcmVkRGF0YUJ5SGFzaCBmaXJzdFxuICAgICAgaWYgKCFzaGFyZWREYXRhQnlIYXNoW2hhc2hdKSB7XG4gICAgICAgIC8vIFJldXNlIHJlcXVlc3QgZm9yIGR1cGxpY2F0ZSBpbmZsaWdodCByZXF1ZXN0c1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHN0YXRpY0RhdGFQYXRoID0gcGF0aEpvaW4oXG4gICAgICAgICAgICBwcm9jZXNzLmVudi5SRUFDVF9TVEFUSUNfQVNTRVRTX1BBVEgsXG4gICAgICAgICAgICBgc3RhdGljRGF0YS8ke2hhc2h9Lmpzb25gXG4gICAgICAgICAgKVxuICAgICAgICAgIGNvbnN0IGFic29sdXRlU3RhdGljRGF0YVBhdGggPSBtYWtlUGF0aEFic29sdXRlKHN0YXRpY0RhdGFQYXRoKVxuXG4gICAgICAgICAgLy8gSWYgcHJpb3JpdHksIGdldCBpdCBpbW1lZGlhdGVseVxuICAgICAgICAgIGlmIChwcmlvcml0eSkge1xuICAgICAgICAgICAgY29uc3QgeyBkYXRhOiBwcm9wIH0gPSBhd2FpdCBheGlvcy5nZXQoYWJzb2x1dGVTdGF0aWNEYXRhUGF0aClcbiAgICAgICAgICAgIHNoYXJlZERhdGFCeUhhc2hbaGFzaF0gPSBwcm9wXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIE5vbiBwcmlvcml0eSwgc2hhcmUgaW5mbGlnaHQgcmVxdWVzdHMgYW5kIHVzZSBwb29sXG4gICAgICAgICAgICBpZiAoIWluZmxpZ2h0UHJvcEhhc2hlc1toYXNoXSkge1xuICAgICAgICAgICAgICBpbmZsaWdodFByb3BIYXNoZXNbaGFzaF0gPSByZXF1ZXN0UG9vbC5hZGQoKCkgPT5cbiAgICAgICAgICAgICAgICBheGlvcy5nZXQoYWJzb2x1dGVTdGF0aWNEYXRhUGF0aClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgeyBkYXRhOiBwcm9wIH0gPSBhd2FpdCBpbmZsaWdodFByb3BIYXNoZXNbaGFzaF1cbiAgICAgICAgICAgIC8vIFBsYWNlIGl0IGluIHRoZSBjYWNoZVxuICAgICAgICAgICAgc2hhcmVkRGF0YUJ5SGFzaFtoYXNoXSA9IHByb3BcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgJ0Vycm9yOiBUaGVyZSB3YXMgYW4gZXJyb3IgcmV0cmlldmluZyBhIHByb3AgZm9yIHRoaXMgcm91dGUhIGhhc2hJRDonLFxuICAgICAgICAgICAgaGFzaFxuICAgICAgICAgIClcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycilcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXByaW9yaXR5KSB7XG4gICAgICAgICAgZGVsZXRlIGluZmxpZ2h0UHJvcEhhc2hlc1toYXNoXVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIE90aGVyd2lzZSwganVzdCBzZXQgaXQgYXMgdGhlIGtleVxuICAgICAgcm91dGVJbmZvLnNoYXJlZERhdGFba2V5XSA9IHNoYXJlZERhdGFCeUhhc2hbaGFzaF1cbiAgICB9KVxuICApXG5cbiAgcmV0dXJuIGdldEZ1bGxSb3V0ZURhdGEocm91dGVJbmZvKVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJlZmV0Y2hUZW1wbGF0ZShwYXRoLCB7IHByaW9yaXR5IH0gPSB7fSkge1xuICAvLyBDbGVhbiB0aGUgcGF0aFxuICBwYXRoID0gZ2V0Um91dGVQYXRoKHBhdGgpXG4gIC8vIEdldCByb3V0ZSBpbmZvIHNvIHdlIGNhbiBjaGVjayBpZiBwYXRoIGhhcyBhbnkgZGF0YVxuICBjb25zdCByb3V0ZUluZm8gPSBhd2FpdCBnZXRSb3V0ZUluZm8ocGF0aCwgeyBwcmlvcml0eSB9KVxuXG4gIGlmIChyb3V0ZUluZm8pIHtcbiAgICAvLyBNYWtlIHN1cmUgdG8gdXNlIHRoZSBwYXRoIGFzIGRlZmluZWQgaW4gdGhlIHJvdXRlSW5mbyBvYmplY3QgaGVyZS5cbiAgICAvLyBUaGlzIHdpbGwgbWFrZSBzdXJlIDQwNCByb3V0ZSBpbmZvIHJldHVybmVkIGZyb20gZ2V0Um91dGVJbmZvIGlzIGhhbmRsZWQgY29ycmVjdGx5LlxuICAgIHJlZ2lzdGVyVGVtcGxhdGVGb3JQYXRoKHJvdXRlSW5mby5wYXRoLCByb3V0ZUluZm8udGVtcGxhdGUpXG4gIH1cblxuICAvLyBQcmVsb2FkIHRoZSB0ZW1wbGF0ZSBpZiBhdmFpbGFibGVcbiAgY29uc3QgVGVtcGxhdGUgPSB0ZW1wbGF0ZXNCeVBhdGhbcGF0aF1cbiAgaWYgKCFUZW1wbGF0ZSkge1xuICAgIC8vIElmIG5vIHRlbXBsYXRlIHdhcyBmb3VuZCwgbWFyayBpdCB3aXRoIGFuIGVycm9yXG4gICAgdGVtcGxhdGVFcnJvckJ5UGF0aFtwYXRoXSA9IHRydWVcbiAgICByZXR1cm5cbiAgfVxuXG4gIC8vIElmIHdlIGRpZG4ndCBubyByb3V0ZSBpbmZvIHdhcyByZXR1cm4sIHRoZXJlIGlzIG5vdGhpbmcgbW9yZSB0byBkbyBoZXJlXG4gIGlmICghcm91dGVJbmZvKSB7XG4gICAgcmV0dXJuIFRlbXBsYXRlXG4gIH1cblxuICBpZiAoIXJvdXRlSW5mby50ZW1wbGF0ZUxvYWRlZCAmJiBUZW1wbGF0ZS5wcmVsb2FkKSB7XG4gICAgaWYgKHByaW9yaXR5KSB7XG4gICAgICBhd2FpdCBUZW1wbGF0ZS5wcmVsb2FkKClcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgcmVxdWVzdFBvb2wuYWRkKCgpID0+IFRlbXBsYXRlLnByZWxvYWQoKSlcbiAgICB9XG4gICAgcm91dGVJbmZvLnRlbXBsYXRlTG9hZGVkID0gdHJ1ZVxuICB9XG4gIHJldHVybiBUZW1wbGF0ZVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJlZmV0Y2gocGF0aCwgb3B0aW9ucyA9IHt9KSB7XG4gIC8vIENsZWFuIHRoZSBwYXRoXG4gIHBhdGggPSBnZXRSb3V0ZVBhdGgocGF0aClcblxuICBjb25zdCB7IHR5cGUgfSA9IG9wdGlvbnNcblxuICAvLyBJZiBpdCdzIHByaW9yaXR5LCB3ZSBzdG9wIHRoZSBxdWV1ZSB0ZW1wb3JhcmlseVxuICBpZiAob3B0aW9ucy5wcmlvcml0eSkge1xuICAgIHJlcXVlc3RQb29sLnN0b3AoKVxuICB9XG5cbiAgbGV0IGRhdGFcbiAgaWYgKHR5cGUgPT09ICdkYXRhJykge1xuICAgIGRhdGEgPSBhd2FpdCBwcmVmZXRjaERhdGEocGF0aCwgb3B0aW9ucylcbiAgfSBlbHNlIGlmICh0eXBlID09PSAndGVtcGxhdGUnKSB7XG4gICAgYXdhaXQgcHJlZmV0Y2hUZW1wbGF0ZShwYXRoLCBvcHRpb25zKVxuICB9IGVsc2Uge1xuICAgIDtbZGF0YV0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICBwcmVmZXRjaERhdGEocGF0aCwgb3B0aW9ucyksXG4gICAgICBwcmVmZXRjaFRlbXBsYXRlKHBhdGgsIG9wdGlvbnMpLFxuICAgIF0pXG4gIH1cblxuICAvLyBJZiBpdCB3YXMgcHJpb3JpdHksIHN0YXJ0IHRoZSBxdWV1ZSBhZ2FpblxuICBpZiAob3B0aW9ucy5wcmlvcml0eSkge1xuICAgIHJlcXVlc3RQb29sLnN0YXJ0KClcbiAgfVxuXG4gIHJldHVybiBkYXRhXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1ByZWZldGNoYWJsZVJvdXRlKHBhdGgpIHtcbiAgLy8gd2hlbiByZW5kZXJpbmcgc3RhdGljIHBhZ2VzIHdlIGRvbnQgbmVlZCB0aGlzIGF0IGFsbFxuICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJykge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgaWYgKFxuICAgIHByZWZldGNoRXhjbHVkZXMuc29tZShleGNsdWRlID0+IHtcbiAgICAgIGlmICh0eXBlb2YgZXhjbHVkZSA9PT0gJ3N0cmluZycgJiYgcGF0aC5zdGFydHNXaXRoKGV4Y2x1ZGUpKSB7XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIGV4Y2x1ZGUgPT09ICdvYmplY3QnICYmIGV4Y2x1ZGUudGVzdChwYXRoKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfSlcbiAgKSB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICBjb25zdCB7IGxvY2F0aW9uIH0gPSBkb2N1bWVudFxuICBsZXQgbGlua1xuXG4gIHRyeSB7XG4gICAgbGluayA9IG5ldyBVUkwocGF0aCwgbG9jYXRpb24uaHJlZilcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmICh0eXBlb2YgVVJMICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAnVVJMIHBvbHlmaWxsIGlzIHJlcXVpcmVkIGZvciB0aGlzIGJyb3dzZXIuIGh0dHBzOi8vZ2l0aHViLmNvbS9yZWFjdC1zdGF0aWMvcmVhY3Qtc3RhdGljL2Jsb2IvbWFzdGVyL2RvY3MvY29uY2VwdHMubWQjYnJvd3Nlci1zdXBwb3J0J1xuICAgICAgKVxuICAgIH1cbiAgICAvLyBSZXR1cm4gZmFsc2Ugb24gaW52YWxpZCBVUkxzXG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICAvLyBpZiB0aGUgaG9zdG5hbWUvcG9ydC9wcm90b2NvbCBkb2Vzbid0IG1hdGNoIGl0cyBub3QgYSByb3V0ZSBsaW5rXG4gIGlmIChsb2NhdGlvbi5ob3N0ICE9PSBsaW5rLmhvc3QgfHwgbG9jYXRpb24ucHJvdG9jb2wgIT09IGxpbmsucHJvdG9jb2wpIHtcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIC8vIGRlbnkgYWxsIGZpbGVzIHdpdGggZXh0ZW5zaW9uIG90aGVyIHRoYW4gLmh0bWxcbiAgLy8gUmV2ZXJ0aW5nIHRoaXMgY2hhbmdlIGJlY2F1c2Ugb2YgaXNzdWUgIzEzNTRcbiAgLy8gaWYgKGxpbmsucGF0aG5hbWUuaW5jbHVkZXMoJy4nKSAmJiAhbGluay5wYXRobmFtZS5pbmNsdWRlcygnLmh0bWwnKSkge1xuICAvLyAgIHJldHVybiBmYWxzZVxuICAvLyB9XG5cbiAgcmV0dXJuIHRydWVcbn1cblxuZXhwb3J0IGNvbnN0IHBsdWdpbnMgPSB7XG4gIFJvb3Q6IENvbXAgPT4ge1xuICAgIGNvbnN0IGhvb2tzID0gZ2V0SG9va3MocGx1Z2luSG9va3MsICdSb290JylcbiAgICByZXR1cm4gcmVkdWNlSG9va3MoaG9va3MsIHsgc3luYzogdHJ1ZSB9KShDb21wKVxuICB9LFxuICBSb3V0ZXM6IENvbXAgPT4ge1xuICAgIGNvbnN0IGhvb2tzID0gZ2V0SG9va3MocGx1Z2luSG9va3MsICdSb3V0ZXMnKVxuICAgIHJldHVybiByZWR1Y2VIb29rcyhob29rcywgeyBzeW5jOiB0cnVlIH0pKENvbXApXG4gIH0sXG59XG4iXX0=
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = getRouteData;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function getRouteData(_x, _x2) {
  return _getRouteData.apply(this, arguments);
}

function _getRouteData() {
  _getRouteData = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee(route, state) {
    var sharedDataByHash,
        data,
        sharedHashesByProp,
        newSharedData,
        _args = arguments;
    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            sharedDataByHash = _args.length > 2 && _args[2] !== undefined ? _args[2] : new Map();
            _context.t0 = !!route.getData;

            if (!_context.t0) {
              _context.next = 6;
              break;
            }

            _context.next = 5;
            return route.getData(_objectSpread(_objectSpread({}, state), {}, {
              route: route
            }));

          case 5:
            _context.t0 = _context.sent;

          case 6:
            data = _context.t0;
            // Default data (must be an object)
            data = data || {}; // Extract any shared data

            sharedHashesByProp = {};
            newSharedData = {};

            if (route.sharedData) {
              Object.keys(route.sharedData).forEach(function (name) {
                var sharedPiece = route.sharedData[name];
                sharedDataByHash.set(sharedPiece.hash, sharedPiece);
                sharedHashesByProp[name] = sharedPiece.hash;
                newSharedData[name] = sharedPiece.data;
              });
            }

            return _context.abrupt("return", _objectSpread(_objectSpread({}, route), {}, {
              data: data,
              sharedHashesByProp: sharedHashesByProp,
              sharedData: newSharedData
            }));

          case 12:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  }));
  return _getRouteData.apply(this, arguments);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdGF0aWMvZ2V0Um91dGVEYXRhLmpzIl0sIm5hbWVzIjpbImdldFJvdXRlRGF0YSIsInJvdXRlIiwic3RhdGUiLCJzaGFyZWREYXRhQnlIYXNoIiwiTWFwIiwiZ2V0RGF0YSIsImRhdGEiLCJzaGFyZWRIYXNoZXNCeVByb3AiLCJuZXdTaGFyZWREYXRhIiwic2hhcmVkRGF0YSIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwibmFtZSIsInNoYXJlZFBpZWNlIiwic2V0IiwiaGFzaCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztTQUE4QkEsWTs7Ozs7Z0dBQWYsaUJBQ2JDLEtBRGEsRUFFYkMsS0FGYTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdiQyxZQUFBQSxnQkFIYSwyREFHTSxJQUFJQyxHQUFKLEVBSE47QUFBQSwwQkFNRixDQUFDLENBQUNILEtBQUssQ0FBQ0ksT0FOTjs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFBQTtBQUFBLG1CQU13QkosS0FBSyxDQUFDSSxPQUFOLGlDQUFtQkgsS0FBbkI7QUFBMEJELGNBQUFBLEtBQUssRUFBTEE7QUFBMUIsZUFOeEI7O0FBQUE7QUFBQTs7QUFBQTtBQU1USyxZQUFBQSxJQU5TO0FBT2I7QUFDQUEsWUFBQUEsSUFBSSxHQUFHQSxJQUFJLElBQUksRUFBZixDQVJhLENBU2I7O0FBQ01DLFlBQUFBLGtCQVZPLEdBVWMsRUFWZDtBQVdQQyxZQUFBQSxhQVhPLEdBV1MsRUFYVDs7QUFhYixnQkFBSVAsS0FBSyxDQUFDUSxVQUFWLEVBQXNCO0FBQ3BCQyxjQUFBQSxNQUFNLENBQUNDLElBQVAsQ0FBWVYsS0FBSyxDQUFDUSxVQUFsQixFQUE4QkcsT0FBOUIsQ0FBc0MsVUFBQUMsSUFBSSxFQUFJO0FBQzVDLG9CQUFNQyxXQUFXLEdBQUdiLEtBQUssQ0FBQ1EsVUFBTixDQUFpQkksSUFBakIsQ0FBcEI7QUFDQVYsZ0JBQUFBLGdCQUFnQixDQUFDWSxHQUFqQixDQUFxQkQsV0FBVyxDQUFDRSxJQUFqQyxFQUF1Q0YsV0FBdkM7QUFDQVAsZ0JBQUFBLGtCQUFrQixDQUFDTSxJQUFELENBQWxCLEdBQTJCQyxXQUFXLENBQUNFLElBQXZDO0FBQ0FSLGdCQUFBQSxhQUFhLENBQUNLLElBQUQsQ0FBYixHQUFzQkMsV0FBVyxDQUFDUixJQUFsQztBQUNELGVBTEQ7QUFNRDs7QUFwQlksNkVBdUJSTCxLQXZCUTtBQXdCWEssY0FBQUEsSUFBSSxFQUFKQSxJQXhCVztBQXlCWEMsY0FBQUEsa0JBQWtCLEVBQWxCQSxrQkF6Qlc7QUEwQlhFLGNBQUFBLFVBQVUsRUFBRUQ7QUExQkQ7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGdldFJvdXRlRGF0YShcbiAgcm91dGUsXG4gIHN0YXRlLFxuICBzaGFyZWREYXRhQnlIYXNoID0gbmV3IE1hcCgpXG4pIHtcbiAgLy8gRmV0Y2ggZGF0YSBmcm9tIGVhY2ggcm91dGVcbiAgbGV0IGRhdGEgPSAhIXJvdXRlLmdldERhdGEgJiYgKGF3YWl0IHJvdXRlLmdldERhdGEoeyAuLi5zdGF0ZSwgcm91dGUgfSkpXG4gIC8vIERlZmF1bHQgZGF0YSAobXVzdCBiZSBhbiBvYmplY3QpXG4gIGRhdGEgPSBkYXRhIHx8IHt9XG4gIC8vIEV4dHJhY3QgYW55IHNoYXJlZCBkYXRhXG4gIGNvbnN0IHNoYXJlZEhhc2hlc0J5UHJvcCA9IHt9XG4gIGNvbnN0IG5ld1NoYXJlZERhdGEgPSB7fVxuXG4gIGlmIChyb3V0ZS5zaGFyZWREYXRhKSB7XG4gICAgT2JqZWN0LmtleXMocm91dGUuc2hhcmVkRGF0YSkuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgIGNvbnN0IHNoYXJlZFBpZWNlID0gcm91dGUuc2hhcmVkRGF0YVtuYW1lXVxuICAgICAgc2hhcmVkRGF0YUJ5SGFzaC5zZXQoc2hhcmVkUGllY2UuaGFzaCwgc2hhcmVkUGllY2UpXG4gICAgICBzaGFyZWRIYXNoZXNCeVByb3BbbmFtZV0gPSBzaGFyZWRQaWVjZS5oYXNoXG4gICAgICBuZXdTaGFyZWREYXRhW25hbWVdID0gc2hhcmVkUGllY2UuZGF0YVxuICAgIH0pXG4gIH1cblxuICByZXR1cm4ge1xuICAgIC4uLnJvdXRlLFxuICAgIGRhdGEsXG4gICAgc2hhcmVkSGFzaGVzQnlQcm9wLFxuICAgIHNoYXJlZERhdGE6IG5ld1NoYXJlZERhdGEsXG4gIH1cbn1cbiJdfQ==